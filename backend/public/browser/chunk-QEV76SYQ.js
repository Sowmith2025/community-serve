import{a as tt,b as et,c as it}from"./chunk-IPGB3ACG.js";import{a as nt}from"./chunk-XTTLGJZ5.js";import{a as N,b as W,c as q,d as J,e as Z}from"./chunk-DKIE34ZN.js";import{B as Q,v as G,w as V,x as X,y as U,z as K}from"./chunk-ICS7QMHG.js";import{Aa as n,Ba as g,Ca as R,Da as k,Ga as I,Ha as E,Pa as r,Qa as x,R as T,Ra as M,Ta as D,X as S,Y as F,Ya as O,a as P,b as w,e as L,fb as $,gb as j,ha as o,ia as C,ib as Y,pb as z,qb as B,sa as _,sb as H,ta as p,ua as u,va as A,za as e}from"./chunk-GNEUTEOT.js";function at(d,m){d&1&&g(0,"mat-progress-bar",34)}function ot(d,m){if(d&1&&(e(0,"div",35),r(1),n()),d&2){let i=E();o(),x(i.error)}}function rt(d,m){if(d&1&&(S(),R(0),g(1,"circle",36),k()),d&2){let i=m.$implicit,s=m.index,t=E();o(),p("cx",32+496*(s/(t.monthLabels.length-1)))("cy",16+(148-i/t.monthlyMaxCount*148))("fill","var(--chart-registered)")}}function st(d,m){if(d&1&&(S(),R(0),g(1,"circle",36),k()),d&2){let i=m.$implicit,s=m.index,t=E();o(),p("cx",32+496*(s/(t.monthLabels.length-1)))("cy",16+(148-i/t.monthlyMaxCount*148))("fill","var(--chart-attended)")}}function dt(d,m){if(d&1&&(S(),R(0),e(1,"text",37),r(2),n(),k()),d&2){let i=m.$implicit,s=m.index,t=E();o(),p("x",32+496*(s/(t.monthLabels.length-1))),o(),x(i)}}function lt(d,m){if(d&1&&(e(0,"mat-card")(1,"mat-card-title"),r(2),n(),e(3,"mat-card-content")(4,"p"),r(5),n(),e(6,"p"),r(7),n(),e(8,"p"),r(9),n()()()),d&2){let i=m.$implicit;o(2),x(i.title),o(3),x(i.description),o(2),D("",i.date," ",i.time," @ ",i.location,""),o(2),M("Status: ",i.status,"")}}function mt(d,m){if(d&1&&(e(0,"mat-card")(1,"mat-card-title"),r(2),n(),e(3,"mat-card-content")(4,"p"),r(5),n(),e(6,"p"),r(7),n(),e(8,"p"),r(9),n()()()),d&2){let i=m.$implicit;o(2),x(i.event==null?null:i.event.title),o(3),M("Hours: ",i.hours,""),o(2),M("Checked in: ",i.checkInTime,""),o(2),M("Checked out: ",i.checkOutTime,"")}}var At=(()=>{class d{get maxParticipationCount(){return Math.max(this.totalRegistered||0,this.totalAttended||0,1)}constructor(i,s,t,h,l){this.users=i,this.auth=s,this.eventsService=t,this.theme=h,this.router=l,this.loading=!1,this.error="",this.registered=[],this.attended=[],this.totalRegistered=0,this.totalAttended=0,this.participationRate=0,this.monthLabels=[],this.monthlyRegisteredCounts=[],this.monthlyAttendedCounts=[],this.monthlyMaxCount=1,this.linePointsRegistered="",this.linePointsAttended="",this.chartWidth=560,this.chartHeight=180,this.chartPadX=32,this.chartPadY=16}ngOnInit(){return L(this,null,function*(){let i=this.auth.getCurrentUser();if(i){this.loading=!0;try{let s=yield this.users.getProfile(i.id);this.registered=s.data.data?.registeredEvents||s.data.registeredEvents||[];let t=new Set((this.registered||[]).map(l=>l.id)),h={};for(let l of this.registered)l&&l.id&&(h[l.id]=l);this.attended=(s.data.data?.attendance||s.data.attendance||[]).filter(l=>t.has(l.eventId)).map(l=>w(P({},l),{event:h[l.eventId]})),this.totalRegistered=(this.registered||[]).length,this.totalAttended=(this.attended||[]).length,this.participationRate=this.totalRegistered>0?Math.round(this.totalAttended/this.totalRegistered*100):0,this.computeMonthlySeries(),console.log("Dashboard - Registered events:",this.registered),console.log("Dashboard - Attended events:",this.attended),console.log("Dashboard - Metrics:",{totalRegistered:this.totalRegistered,totalAttended:this.totalAttended,participationRate:this.participationRate+"%"})}catch(s){this.error=s?.response?.data?.message||"Failed to load dashboard"}finally{this.loading=!1}}})}logout(){this.auth.logout(),this.router.navigateByUrl("/home")}computeMonthlySeries(){let i=new Date,s=[],t=a=>`${a.getFullYear()}-${String(a.getMonth()+1).padStart(2,"0")}`,h=a=>a.toLocaleString(void 0,{month:"short"}),l=[];for(let a=5;a>=0;a--){let c=new Date(i.getFullYear(),i.getMonth()-a,1);l.push(c),s.push(t(c))}let b=Object.fromEntries(s.map(a=>[a,0])),y=Object.fromEntries(s.map(a=>[a,0]));for(let a of this.registered){let c=a?.date||a?.createdAt;if(!c)continue;let f=new Date(c),v=t(new Date(f.getFullYear(),f.getMonth(),1));v in b&&b[v]++}for(let a of this.attended){let c=a?.checkInTime||a?.checkOutTime;if(!c)continue;let f=new Date(c),v=t(new Date(f.getFullYear(),f.getMonth(),1));v in y&&y[v]++}this.monthLabels=l.map(h),this.monthlyRegisteredCounts=s.map(a=>b[a]||0),this.monthlyAttendedCounts=s.map(a=>y[a]||0),this.monthlyMaxCount=Math.max(1,...this.monthlyRegisteredCounts,...this.monthlyAttendedCounts),this.computeLinePoints()}computeLinePoints(){let i=this.chartWidth-this.chartPadX*2,s=this.chartHeight-this.chartPadY*2,t=this.monthLabels.length;if(t<=1){this.linePointsRegistered="",this.linePointsAttended="";return}let h=i/(t-1),l=a=>this.chartPadY+(s-a/this.monthlyMaxCount*s),b=[],y=[];for(let a=0;a<t;a++){let c=this.chartPadX+h*a,f=l(this.monthlyRegisteredCounts[a]||0),v=l(this.monthlyAttendedCounts[a]||0);b.push(`${c},${f}`),y.push(`${c},${v}`)}this.linePointsRegistered=b.join(" "),this.linePointsAttended=y.join(" ")}static{this.\u0275fac=function(s){return new(s||d)(C(nt),C(Q),C(it),C(Z),C(z))}}static{this.\u0275cmp=T({type:d,selectors:[["app-dashboard"]],standalone:!0,features:[O],decls:65,vars:26,consts:[["color","primary"],[1,"spacer"],[1,"nav-links"],["mat-button","","routerLink","/home"],["mat-button","","routerLink","/events"],["mat-button","","routerLink","/dashboard"],["mat-button","","routerLink","/profile"],["mat-button","","routerLink","/login",3,"click"],["mat-button","","aria-label","Toggle theme",3,"click"],[1,"container"],["mode","indeterminate",4,"ngIf"],["class","error",4,"ngIf"],[2,"margin","16px 0"],[2,"font-size","13px","color","var(--text-secondary)"],[2,"display","flex","gap","16px","align-items","flex-end","margin-top","12px"],[2,"flex","1"],[2,"height","140px","border-left","1px solid #ccc","border-bottom","1px solid #ccc","padding","8px","display","flex","align-items","flex-end"],["title","Registered",2,"background","#90caf9"],["title","Attended",2,"background","#66bb6a","margin-left","8px"],[2,"display","flex","justify-content","space-between","font-size","12px","margin-top","6px"],[2,"margin","24px 0"],[2,"font-size","12px","color","var(--text-secondary)","margin-bottom","6px"],[2,"overflow-x","auto"],["preserveAspectRatio","none",2,"width","100%","max-width","720px","height","auto","border","1px solid var(--color-border)","border-radius","4px","background","transparent"],["x1","32","y1","164","x2","528","y2","164","stroke","#ccc","stroke-width","1"],["x1","32","y1","16","x2","32","y2","164","stroke","#ccc","stroke-width","1"],["fill","none","stroke-width","2"],[4,"ngFor","ngForOf"],["x","420","y","22","width","10","height","10"],["x","435","y","31","font-size","10","fill","currentColor"],["x","420","y","38","width","10","height","10"],["x","435","y","47","font-size","10","fill","currentColor"],[1,"grid"],[2,"margin-top","24px"],["mode","indeterminate"],[1,"error"],["r","3"],["y","176","text-anchor","middle","font-size","10","fill","currentColor"]],template:function(s,t){s&1&&(e(0,"mat-toolbar",0)(1,"span"),r(2,"Community Service"),n(),g(3,"span",1),e(4,"nav",2)(5,"a",3),r(6,"Home"),n(),e(7,"a",4),r(8,"Events"),n(),e(9,"a",5),r(10,"Dashboard"),n(),e(11,"a",6),r(12,"Profile"),n(),e(13,"a",7),I("click",function(l){return l.preventDefault(),t.logout()}),r(14,"Logout"),n(),e(15,"button",8),I("click",function(){return t.theme.toggle()}),r(16),n()()(),e(17,"div",9)(18,"h2"),r(19,"Dashboard"),n(),_(20,at,1,0,"mat-progress-bar",10)(21,ot,2,1,"div",11),e(22,"div",12)(23,"h3"),r(24,"Participation"),n(),e(25,"div",13),r(26),n(),e(27,"div",14)(28,"div",15)(29,"div",16),g(30,"div",17)(31,"div",18),n(),e(32,"div",19)(33,"span"),r(34,"Registered"),n(),e(35,"span"),r(36,"Attended"),n()()()()(),e(37,"div",20)(38,"h3"),r(39,"Monthly Participation"),n(),e(40,"div",21),r(41,"Last 6 months"),n(),e(42,"div",22),S(),e(43,"svg",23),g(44,"line",24)(45,"line",25)(46,"polyline",26)(47,"polyline",26),_(48,rt,2,3,"ng-container",27)(49,st,2,3,"ng-container",27)(50,dt,3,2,"ng-container",27),g(51,"rect",28),e(52,"text",29),r(53,"Registered"),n(),g(54,"rect",30),e(55,"text",31),r(56,"Attended"),n()()()(),F(),e(57,"h3"),r(58,"Registered Events"),n(),e(59,"div",32),_(60,lt,10,6,"mat-card",27),n(),e(61,"h3",33),r(62,"Attended Events"),n(),e(63,"div",32),_(64,mt,10,4,"mat-card",27),n()()),s&2&&(o(16),x(t.theme.isDark()?"Light mode":"Dark mode"),o(4),u("ngIf",t.loading),o(),u("ngIf",t.error),o(5),D("Registered: ",t.totalRegistered," \u2022 Attended: ",t.totalAttended," \u2022 Rate: ",t.participationRate,"%"),o(4),A("width",40,"%")("height",t.totalRegistered/t.maxParticipationCount*100,"%"),o(),A("width",40,"%")("height",t.totalAttended/t.maxParticipationCount*100,"%"),o(12),p("viewBox","0 0 560 180"),o(3),p("points",t.linePointsRegistered)("stroke","var(--chart-registered)"),o(),p("points",t.linePointsAttended)("stroke","var(--chart-attended)"),o(),u("ngForOf",t.monthlyRegisteredCounts),o(),u("ngForOf",t.monthlyAttendedCounts),o(),u("ngForOf",t.monthLabels),o(),p("fill","var(--chart-registered)"),o(3),p("fill","var(--chart-attended)"),o(6),u("ngForOf",t.registered),o(4),u("ngForOf",t.attended))},dependencies:[Y,$,j,H,B,V,G,K,U,X,J,N,q,W,et,tt]})}}return d})();export{At as DashboardComponent};
